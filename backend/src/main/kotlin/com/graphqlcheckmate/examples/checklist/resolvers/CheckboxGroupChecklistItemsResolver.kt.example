// EXAMPLE: Field Resolver for Group's Checklist Items
//
// This file demonstrates how to implement a field resolver for nested data.
//
// KEY CONCEPTS DEMONSTRATED:
// - Field resolvers for nested relationships
// - Using objectValueFragment to access parent object data
// - Accessing parent's GlobalID and decoding to UUID
// - Efficient N+1 prevention (DataLoader pattern can be added)
//
// IMPORTANT: This is a FIELD resolver, not a top-level query resolver.
// It resolves the "checklistItems" field on the "CheckboxGroup" type.
//
// TO USE THIS EXAMPLE:
// 1. Copy to backend/src/main/kotlin/com/graphqlcheckmate/resolvers/
// 2. Rename to GroupYourResourcesResolver.kt
// 3. Uncomment the code below
// 4. Customize for your resource type
// 5. Update objectValueFragment to match your parent type

/*
package com.graphqlcheckmate.resolvers

import com.graphqlcheckmate.resolvers.resolverbases.CheckboxGroupResolvers
import viaduct.api.Resolver
import viaduct.api.grts.ChecklistItem

/**
 * Field resolver for CheckboxGroup.checklistItems.
 * Returns all checklist items belonging to the checkbox group.
 *
 * Authorization: Database RLS policies enforce access control.
 * This resolver is only called if the user has access to the parent CheckboxGroup.
 *
 * The @Resolver annotation with objectValueFragment tells Viaduct:
 * - This resolves a field on the CheckboxGroup type
 * - We need access to the parent CheckboxGroup's "id" field
 * - The fragment ensures the parent's ID is available in ctx.objectValue
 */
@Resolver(objectValueFragment = "fragment _ on CheckboxGroup { id }")
class CheckboxGroupChecklistItemsResolver : CheckboxGroupResolvers.ChecklistItems() {
    override suspend fun resolve(ctx: Context): List<ChecklistItem> {
        // Access parent CheckboxGroup via objectValue
        // This gets the CheckboxGroup that owns these items
        val groupId = ctx.objectValue.getId().internalID

        // Fetch all items for this group
        val itemEntities = ctx.authenticatedClient.getChecklistItemsByGroup(groupId)

        // Map database entities to GraphQL types
        return itemEntities.map { entity ->
            ChecklistItem.Builder(ctx)
                .id(ctx.globalIDFor(ChecklistItem.Reflection, entity.id))
                .title(entity.title)
                .completed(entity.completed)
                .userId(entity.user_id)
                .groupId(entity.group_id)
                .createdAt(entity.created_at)
                .updatedAt(entity.updated_at)
                .build()
        }
    }
}

// PERFORMANCE NOTE:
// If you're fetching items for multiple groups in a single query, consider
// implementing a DataLoader pattern to batch database calls and prevent N+1 queries.
// See Viaduct documentation on DataLoaders for more information.
*/
